<div class="page-header">
  <h1>
    <% if @profile.description %>
      <%= @profile.description %>
    <% else %>
      <em>Unknown profile</em>
    <% end %>
  </h1>

  <div class="row">
    <div class="span2">
      <strong>Wall:</strong>
      <%= number_to_human(@profile.total_time / 1000.0,
                          precision: 2,
                          significant: false,
                          units: { unit: 'ms',
                                   thousand: 's' }) %>
    </div>
    <div class="span2">
      <strong>CPU:</strong>
      <%= number_to_human(@profile.cpu_time / 1000.0,
                          precision: 2,
                          significant: false,
                          units: { unit: 'ms',
                                   thousand: 's' }) %>
    </div>
    <div class="span2">
      <strong>Idle:</strong>
      <%= number_to_human(@profile.idle_time / 1000.0,
                          precision: 2,
                          significant: false,
                          units: { unit: 'ms',
                                   thousand: 's' }) %>
    </div>
    <div class="span6">
      <strong>Host:</strong>
      <%= @profile.hostname %>:<%= @profile.pid %>
    </div>
  </div>
  <div class="row">
    <div class="span12">
      <strong>When:</strong>
      <%= time_ago_in_words(@profile.created_at) %> ago
    </div>
  </div>
</div>

<table class="table table-striped table-bordered table-hover">
  <thead>
    <tr>
      <th>Wall</th>
      <th>CPU</th>
      <th>Idle</th>
      <th>Calls</th>
      <th class="fill-column">File</th>
    </tr>
  </thead>
  <% @sorted_profile.each do |filename, file_profile| %>
  <tbody>
    <tr class="<%= file_profile_class(file_profile) %>">
      <td>
        <%= number_to_human(file_profile['total'] / 1000.0,
                            precision: 2,
                            significant: false,
                            units: { unit: 'ms',
                                     thousand: 's' }) %>
      </td>
      <td>
        <%= number_to_human(file_profile['total_cpu'] / 1000.0,
                            precision: 2,
                            significant: false,
                            units: { unit: 'ms',
                                     thousand: 's' }) %>
      </td>
      <td>
        <%= number_to_human([ file_profile['total'] -
                              file_profile['total_cpu'], 0].max / 1000.0,
                            precision: 2,
                            significant: false,
                            units: { unit: 'ms',
                                     thousand: 's' }) %>
      </td>
      <td></td>
      <td><a href="#" class="js-lineprof-file"><%= filename %></a></td>
    </tr>
    <% @profile.file_sources[filename].split("\n").each_with_index do |line, index| %>
    <tr class="line-profile <%= file_profile_class(file_profile, index) %>">
      <td>
        <%= number_to_human(profile_line_wall_time(file_profile, index),
                            precision: 2,
                            significant: false,
                            units: { unit: 'ms',
                                     thousand: 's' }) %>
      </td>
      <td>
        <%= number_to_human(profile_line_cpu_time(file_profile, index),
                            precision: 2,
                            significant: false,
                            units: { unit: 'ms',
                                     thousand: 's' }) %>
      </td>
      <td>
        <%= number_to_human(profile_line_idle_time(file_profile, index),
                            precision: 2,
                            significant: false,
                            units: { unit: 'ms',
                                     thousand: 's' }) %>
      </td>
      <td><%= profile_line_calls(file_profile, index) %></td>
      <td><pre><%= raw(line.empty? ? ' ' : line) %></pre></td>
    </tr>
    <% end %>
  </tbody>
  <% end %>
</table>
